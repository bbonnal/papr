<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:paprUI.ViewModels"
             xmlns:rui="using:rUI.Avalonia.Desktop.Controls"
             xmlns:pia="using:PhosphorIconsAvalonia.Markup"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             mc:Ignorable="d"
             d:DesignWidth="900"
             d:DesignHeight="640"
             x:Class="paprUI.Views.SettingsPageView"
             x:DataType="vm:SettingsPageViewModel">

    <ScrollViewer>
        <StackPanel Margin="24" Spacing="16" MaxWidth="760">
            <Grid ColumnDefinitions="*,Auto,Auto,Auto"
                  ColumnSpacing="8">
                <TextBlock Grid.Column="0"
                           VerticalAlignment="Center"
                           Text="Settings"
                           FontSize="24"
                           FontWeight="SemiBold" />
                <Button Grid.Column="1"
                        Command="{Binding SaveSettingsCommand}"
                        ToolTip.Tip="Save settings">
                    <StackPanel Orientation="Horizontal"
                                Spacing="6">
                        <PathIcon Width="14"
                                  Height="14"
                                  Data="M5 3h10a2 2 0 0 1 2 2v14H3V5a2 2 0 0 1 2-2zm1 2v4h8V5H6zm1 8h6v4H7v-4z" />
                        <TextBlock Text="Save" />
                    </StackPanel>
                </Button>
                <Button Grid.Column="2"
                        Content="Reset defaults"
                        Command="{Binding ResetDefaultsCommand}" />
                <Button Grid.Column="3"
                        Content="Delete persisted"
                        Command="{Binding DeletePersistedSettingsCommand}" />
            </Grid>

            <TextBlock Text="Application-level settings."
                       Foreground="{DynamicResource rUIForegroundSecondaryBrush}" />

            <TextBlock Text="General"
                       FontSize="16"
                       FontWeight="SemiBold"
                       Margin="0,8,0,0" />

            <rui:SettingsCardExpander Header="Language"
                                      Description="Choose the UI language."
                                      IconData="{pia:IconGeometry Icon=translate}">
                <StackPanel Spacing="12">
                    <TextBlock Text="{Binding CurrentLanguageDisplay}"
                               Foreground="{DynamicResource rUIForegroundSecondaryBrush}" />
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <Button Content="English"
                                Command="{Binding SetEnglishCommand}" />
                        <Button Content="French"
                                Command="{Binding SetFrenchCommand}" />
                    </StackPanel>
                </StackPanel>
            </rui:SettingsCardExpander>

            <rui:SettingsCardExpander Header="Theme"
                                      Description="Choose system, light, or dark mode."
                                      IconData="{pia:IconGeometry Icon=palette}">
                <StackPanel Spacing="12">
                    <TextBlock Text="{Binding CurrentThemeDisplay}"
                               Foreground="{DynamicResource rUIForegroundSecondaryBrush}" />
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <Button Content="System"
                                Command="{Binding SetThemeSystemCommand}" />
                        <Button Content="Light"
                                Command="{Binding SetThemeLightCommand}" />
                        <Button Content="Dark"
                                Command="{Binding SetThemeDarkCommand}" />
                    </StackPanel>
                </StackPanel>
            </rui:SettingsCardExpander>

            <rui:SettingsCardExpander Header="Library"
                                      Description="Set where JSON canvases are saved."
                                      IconData="{pia:IconGeometry Icon=folder_open}">
                <TextBox Text="{Binding LibraryPath}" Watermark="Path to JSON library" />
            </rui:SettingsCardExpander>

            <rui:SettingsCardExpander Header="Device Image Matrix"
                                      Description="Configure image rasterization for ESP32 upload."
                                      IconData="{pia:IconGeometry Icon=grid_four}">
                <Grid ColumnDefinitions="Auto,*" RowDefinitions="Auto,Auto,Auto,Auto" ColumnSpacing="8" RowSpacing="8">
                    <TextBlock Grid.Row="0" Grid.Column="0" VerticalAlignment="Center" Text="Max Width" />
                    <TextBox Grid.Row="0" Grid.Column="1" Text="{Binding ImageMatrixMaxWidth}" />
                    <TextBlock Grid.Row="1" Grid.Column="0" VerticalAlignment="Center" Text="Max Height" />
                    <TextBox Grid.Row="1" Grid.Column="1" Text="{Binding ImageMatrixMaxHeight}" />
                    <TextBlock Grid.Row="2" Grid.Column="0" VerticalAlignment="Center" Text="Threshold (0-255)" />
                    <TextBox Grid.Row="2" Grid.Column="1" Text="{Binding ImageMatrixThreshold}" />
                    <TextBlock Grid.Row="3" Grid.Column="0" VerticalAlignment="Center" Text="Invert" />
                    <CheckBox Grid.Row="3" Grid.Column="1" IsChecked="{Binding ImageMatrixInvert}" />
                </Grid>
            </rui:SettingsCardExpander>

            <TextBlock Text="{Binding LastAction}"
                       IsVisible="{Binding LastAction, Converter={x:Static StringConverters.IsNotNullOrEmpty}}"
                       FontWeight="SemiBold"
                       Margin="0,8,0,0" />

            <TextBlock Text="{Binding SaveStatus}"
                       Foreground="{DynamicResource rUIForegroundSecondaryBrush}" />
        </StackPanel>
    </ScrollViewer>
</UserControl>
